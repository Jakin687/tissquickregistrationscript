// ==UserScript==
// @name         TQR by Jakin
// @version      2.7.1
// @description  Script to help you to get into the group you want. Opens automatically the right panel, registers automatically and confirms your registration automatically. If you don't want the script to do everything automatically, the focus is already set on the right button, so you only need to confirm. There is also an option available to auto refresh the page, if the registration button is not available yet, so you can open the site and watch the script doing its work. You can also set a specific time when the script should reload the page and start.
// @copyright    2024 Jakob Kinne, MIT License
// @require      http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js
// @match        https://tiss.tuwien.ac.at/education/course/courseRegistration.xhtml*
// @match        https://tiss.tuwien.ac.at/education/course/register.xhtml*
// @match        https://tiss.tuwien.ac.at/education/course/groupList.xhtml*
// @match        https://tiss.tuwien.ac.at/education/course/examDateList.xhtml*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tuwien.ac.at
// @updateURL    https://raw.githubusercontent.com/Jakin687/tissquickregistrationscript/master/src/tiss_quick_registration_script_v2.min.js
// @downloadURL  https://raw.githubusercontent.com/Jakin687/tissquickregistrationscript/master/src/tiss_quick_registration_script_v2.min.js
// ==/UserScript==
let tqrOption={type:{LVA:"lva",GROUP:"group",EXAM:"exam",NONE:"none"},excludedOptions:["lvaNumber","registrationType","started","dspwid"],localStorageKey:"TQRSavedOptions"},autoConfirmUrls=["https://tiss.tuwien.ac.at/education/course/courseRegistration.xhtml","https://tiss.tuwien.ac.at/education/course/register.xhtml","https://tiss.tuwien.ac.at/education/course/groupList.xhtml","https://tiss.tuwien.ac.at/education/course/examDateList.xhtml"],strings={ids:{tqr:{countdown:"#tqr-countdown",logWindow:"#tqr-log-window",confForm:"#tqr-conf-form",selectOption:"#tqr-select-option",buttonSave:"#tqr-button-save",buttonDelete:"#tqr-button-delete",buttonStart:"#tqr-button-start",buttonStop:"#tqr-button-stop"},tiss:{content:"#contentInner",header:"#headerInner",subHeader:"#subHeader",languageDe:"#language_de",lenguageEn:"#language_en"}},classes:{tqr:{log:".tqr-log",inputConf:".tqr-input-conf-field",highlight:".tqr-highlight"},tiss:{groupWrapper:".groupWrapper"}},attributes:{tqr:{optionName:"aria-option-name"}}},localisations={en:{lvaRegistration:"Course registration",groups:"Groups",exams:"Exams",register:"Register",preRegister:"Pre-Register",preRegistration:"Pre-Registration",deregister:"Deregistration"},de:{lvaRegistration:"LVA-Anmeldung",groups:"Gruppen",exams:"PrÃ¼fungen",register:"Anmelden",preRegister:"Voranmelden",preRegistration:"Voranmeldung",deregister:"Abmelden"}};localisations=$(strings.ids.tiss.languageDe).length>0?localisations.en:localisations.de;class TQROption{constructor(){this.options={lvaCheckEnabled:!0,lvaSemesterCheckEnabled:!0,openPanel:!0,autoRegister:!0,autoConfirm:!0,autoRefresh:!0,autoOkPressAtEnd:!0,startAtSpecificTime:!0,okPressAtEndDelayInMs:1e3,delayAdjustmentInMs:300,specificStartTime:TQROption.getDate(2024,9,9,0,0),lvaSemester:TQROption.getCurrentOrNextSemester(),registrationType:tqrOption.type.NONE,started:!1,lvaNumber:"",dspwid:-1}}static convertToJson(t){return JSON.stringify(t)}static convertToObject(t){return JSON.parse(t)}static getLocalStorageObject(){let t=localStorage.getItem(tqrOption.localStorageKey),i=TQROption.convertToObject(t);return null===i?{}:i}static getLocalStorageKeys(){return Object.keys(TQROption.getLocalStorageObject())}static loadObject(t,i){let e=TQROption.getLocalStorageObject();return e[t+"/"+i]}static loadTQROption(t,i){let e=TQROption.loadObject(t,i);if(void 0===e&&(TissQuickRegistration.log("No existing settings found!"),TissQuickRegistration.log("Creating default options ...")),i==tqrOption.type.LVA)return void 0===e?(new TQRLvaOption).lvaNumber(t):(new TQRLvaOption).setOptions(e);if(i==tqrOption.type.GROUP)return void 0===e?(new TQRGroupOption).lvaNumber(t):(new TQRGroupOption).setOptions(e);if(i==tqrOption.type.EXAM)return void 0===e?(new TQRExamOption).lvaNumber(t):(new TQRExamOption).setOptions(e);if(i==tqrOption.type.NONE)return null;throw new Error("Registration type not valid")}static loadTQROptionFromDspwid(t){let i=TQROption.getLocalStorageObject();for(const e of Object.values(i))if(e.dspwid==t)return this.loadTQROption(e.lvaNumber,e.registrationType);return null}getKey(){return this.options.lvaNumber+"/"+this.options.registrationType}save(){let t=TQROption.getLocalStorageObject();t[this.getKey()]=this.options,localStorage.setItem(tqrOption.localStorageKey,TQROption.convertToJson(t))}remove(){let t=TQROption.getLocalStorageObject();delete t[this.getKey()],localStorage.setItem(tqrOption.localStorageKey,TQROption.convertToJson(t))}setOptions(t){for(const[i,e]of Object.entries(t))this.options[i]=e;return"string"==typeof this.options.specificStartTime&&(this.options.specificStartTime=new Date(this.options.specificStartTime)),this}get(t){return this.options[t]}initBuildFunctions(){for(const[t,i]of Object.entries(this.options))this[t]=function(i){return this.options[t]=i,this},this[t].data=this,this[t].val=function(){return this.data.options[t]}}static getCurrentOrNextSemester(){let t=new Date,i=t.getMonth();return i>5||i<2?t.getFullYear()+"W":t.getFullYear()+"S"}static getDate(t,i,e,s,o){return new Date(t,i-1,e,s,o,0,0)}}class TQRLvaOption extends TQROption{constructor(){super(),this.options.nameOfGroup=localisations.lvaRegistration,this.options.registrationType=tqrOption.type.LVA,this.initBuildFunctions()}}class TQRGroupOption extends TQROption{constructor(){super(),this.options.nameOfGroup="",this.options.registrationType=tqrOption.type.GROUP,this.initBuildFunctions()}}class TQRExamOption extends TQROption{constructor(){super(),this.options.nameOfExam="",this.options.dateOfExam=new Date,this.options.registrationType=tqrOption.type.EXAM,this.initBuildFunctions()}setOptions(t){return super.setOptions(t),"string"==typeof this.options.dateOfExam&&(this.options.dateOfExam=new Date(this.options.dateOfExam)),this}}class TissQuickRegistration{constructor(){TissQuickRegistration.extendJQuery(),TissQuickRegistration.injectCoreComponents(),TissQuickRegistration.log("Welcome to TQRv2 by JK"),TissQuickRegistration.log("LVA-Number: "+TissQuickRegistration.getLVANumber()),TissQuickRegistration.log("RegistrationType: "+TissQuickRegistration.getRegistrationType()),TissQuickRegistration.log("Semester: "+TissQuickRegistration.getSemester()),TissQuickRegistration.options=null,TissQuickRegistration.injectOptions(),TissQuickRegistration.manageControlAccess(),TissQuickRegistration.hookControlEvents(),TissQuickRegistration.isConfirmURL()&&TissQuickRegistration.disableAllElements(),this.run()}static extendJQuery(){jQuery.fn.justtext=function(){return $(this).clone().children().remove().end().text().trim()},jQuery.fn.disable=function(){let t=$(this);return t.attr("disabled",!0),t},jQuery.fn.enable=function(){let t=$(this);return t.attr("disabled",!1),t}}run(){TissQuickRegistration.options.started.val()&&TissQuickRegistration.getButtonStart().click()}static tissQuickRegistration(){let t=TissQuickRegistration.options;if((!t.lvaCheckEnabled.val()||TissQuickRegistration.doLvaCheck())&&(!t.lvaSemesterCheckEnabled.val()||TissQuickRegistration.doSemesterCheck()))if(t.registrationType.val()!==tqrOption.type.EXAM){if(!TissQuickRegistration.doGroupCheck())return TissQuickRegistration.options.started(!1),void TissQuickRegistration.getButtonStop().click();{let t=TissQuickRegistration.getGroupLabel();TissQuickRegistration.highlight(t),TissQuickRegistration.isConfirmURL()||TissQuickRegistration.log("Group: "+t.text().trim())}}else{if(!TissQuickRegistration.doExamCheck())return TissQuickRegistration.options.started(!1),void TissQuickRegistration.getButtonStop().click();{let t=TissQuickRegistration.getExam();TissQuickRegistration.highlight(t),TissQuickRegistration.isConfirmURL()||TissQuickRegistration.log("Exam: "+t.text().trim())}}t.startAtSpecificTime.val()?(this.log("Script starts at: "+TissQuickRegistration.getFormatedDate(t.specificStartTime.val())),this.log("Delay adjustment in ms: "+t.delayAdjustmentInMs.val()),TissQuickRegistration.startTimer()):TissQuickRegistration.registerAndConfirm()}static startTimer(){let t=TissQuickRegistration.options.specificStartTime.val().getTime()-TissQuickRegistration.options.delayAdjustmentInMs.val(),i=t-(new Date).getTime();i>0?TissQuickRegistration.startRefreshTimer(t):TissQuickRegistration.registerAndConfirm()}static startRefreshTimer(t){TissQuickRegistration.printTimeToStart(t);let i=2147483647,e=t-(new Date).getTime();e>i&&(e=i),window.setTimeout(TissQuickRegistration.refreshPage,e)}static printTimeToStart(t){if(!TissQuickRegistration.options.started.val())return void TissQuickRegistration.removeCountdownField();let i=(t-(new Date).getTime())/1e3,e="Refresh in: ",s=i/60;if(s>1){let t=s/60;t>1&&(e+=Math.floor(t)+"h, ",s%=60),e+=Math.floor(s)+"m and "}let o=i%60;e+=Math.floor(o)+"s",TissQuickRegistration.pageCountdown(e),window.setTimeout(function(){TissQuickRegistration.printTimeToStart(t)},1e3)}static registerAndConfirm(){let t=TissQuickRegistration.getRegistrationType();t===tqrOption.type.LVA?TissQuickRegistration.onLvaPage():t===tqrOption.type.GROUP?TissQuickRegistration.onGroupPage():t===tqrOption.type.EXAM?TissQuickRegistration.onExamPage():TissQuickRegistration.getStudyCodeSelect().length>0?TissQuickRegistration.onStudyCodeSelectPage():TissQuickRegistration.getConfirmButton().length>0?TissQuickRegistration.onConfirmPage():TissQuickRegistration.getOkButton().length>0&&TissQuickRegistration.onConfirmInfoPage()}static getLVANumber(){return $(strings.ids.tiss.content).find("h1 span:first").text().trim()}static getLVAName(){return $(strings.ids.tiss.content).find("h1").justtext()}static getRegistrationType(){let t=TissQuickRegistration.getSemesterTab();return t==localisations.lvaRegistration?tqrOption.type.LVA:t==localisations.groups?tqrOption.type.GROUP:t==localisations.exams?tqrOption.type.EXAM:tqrOption.type.NONE}static getSemester(){return $(strings.ids.tiss.content).find("h1 select").val()}static getSemesterTab(){return $("li.ui-tabs-selected").text().trim()}static getSubHeader(){return $(strings.ids.tiss.content).find(strings.ids.tiss.subHeader).text().trim()}static getCountdownField(){let t=$(strings.ids.tqr.countdown);return 0===t.length&&(TissQuickRegistration.injectCountdownIntoFooter(),t=TissQuickRegistration.getCountdownField()),t}static getLogField(){return $(strings.ids.tqr.logWindow)}static getOptionSelect(){return $(strings.ids.tqr.selectOption)}static getButtonSave(){return $(strings.ids.tqr.buttonSave)}static getButtonDelete(){return $(strings.ids.tqr.buttonDelete)}static getButtonStart(){return $(strings.ids.tqr.buttonStart)}static getButtonStop(){return $(strings.ids.tqr.buttonStop)}static getConfigurationSection(){return $(strings.ids.tqr.confForm)}static getConfigurationInputFields(){return $(strings.classes.tqr.inputConf)}static getDataFromConfigurationSection(){let t={};return TissQuickRegistration.getConfigurationInputFields().each(function(){"checkbox"==this.getAttribute("type")?t[this.getAttribute(strings.attributes.tqr.optionName)]=this.checked:t[this.getAttribute(strings.attributes.tqr.optionName)]=this.value}),t}static getRegistrationButton(t){let i,e=TissQuickRegistration.options.registrationType.val();return Object.values(tqrOption.type).includes(e)?(i=$(t).find("input:submit[value='"+localisations.register+"']"),0===i.length&&(i=$(t).find("input:submit[value='"+localisations.preRegister+"']"),0===i.length&&(i=$(t).find("input:submit[value='"+localisations.preRegistration+"']")))):TissQuickRegistration.error("Registration type is invalid"),i}static getCancelButton(t){let i=null,e=TissQuickRegistration.options.registrationType.val();return e===tqrOption.type.GROUP||e===tqrOption.type.EXAM?i=$(t).find("input:submit[value='"+localisations.deregister+"']"):e===tqrOption.type.LVA?i=$(t).find("input:submit[value='"+localisations.deregister+"']").filter(function(){return"registrationForm:confirmOkBtn"!==$(this).attr("id")}):TissQuickRegistration.error("Registration type is invalid"),i}static getConfirmButton(){let t=$(wrapper).find("form#regForm input:submit[value='"+localisations.register+"']");return 0===t.length&&(t=$(wrapper).find("form#regForm input:submit[value='"+localisations.preRegister+"']"),0===t.length&&(t=$(wrapper).find("form#regForm input:submit[value='"+localisations.preRegistration+"']"))),t}static getOkButton(){return $("form#confirmForm input:submit[value='Ok']")}static getStudyCodeSelect(){return $("#regForm").find("select")}static getGroupLabel(){let t=TissQuickRegistration.options.nameOfGroup.val().trim().replace(/\s\s+/gi," ");return $(".groupWrapper .header_element span").filter(function(){let i=$(this).text().trim().replace(/\s\s+/gi," ");return i===t})}static getExamLabel(){let t=TissQuickRegistration.options.nameOfExam.val();return $(".groupWrapper .header_element.titleCol.titleColStudent.groupHeadertrigger span").filter(function(){let i=$(this).text().trim();return i==t})}static getExamDate(){return $(".groupWrapper .header_element.titleCol.titleColStudent.groupHeadertrigger").filter(function(){let t=$(this).text().trim(),i=TissQuickRegistration.getExamLabel().first().text().trim()+" ",e=t.replace(i,"");return e.match(TissQuickRegistration.getSimpleFormatedDate(TissQuickRegistration.options.dateOfExam.val()))})}static getExam(){return $(".groupWrapper .header_element.titleCol.titleColStudent.groupHeadertrigger").filter(function(){let t=$(this).text().trim();return t==TissQuickRegistration.options.nameOfExam.val()+" "+TissQuickRegistration.getSimpleFormatedDate(TissQuickRegistration.options.dateOfExam.val())})}static getDateFormat(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}static getFormatedDate(t){return t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+":"+t.getMilliseconds()}static getSimpleFormatedDate(t){return`${String(t.getDate()).padStart(2,"0")}.${String(t.getMonth()+1).padStart(2,"0")}.${t.getFullYear()}`}static getDspwid(){return $("input[name='dspwid']").attr("value")}static getHighlightedElements(){return $(strings.classes.tqr.highlight)}static onLvaPage(){TissQuickRegistration.onRegistrationPage(TissQuickRegistration.getGroupLabel())}static onGroupPage(){TissQuickRegistration.onRegistrationPage(TissQuickRegistration.getGroupLabel())}static onExamPage(){TissQuickRegistration.onRegistrationPage(TissQuickRegistration.getExam())}static onRegistrationPage(t){if(null===t)return;let i=TissQuickRegistration.options;if(i.lvaCheckEnabled.val()&&!TissQuickRegistration.doLvaCheck())return;if(i.lvaSemesterCheckEnabled.val()&&!TissQuickRegistration.doSemesterCheck())return;TissQuickRegistration.highlight(t);let e=t.closest(strings.classes.tiss.groupWrapper);i.openPanel.val()&&(e.children().show(),setTimeout(function(){e.children().show()},100));let s=TissQuickRegistration.getRegistrationButton(e);TissQuickRegistration.log("Registration button found"),s.length>0?(TissQuickRegistration.highlight(s),s.focus(),i.autoRegister.val()&&s.click()):TissQuickRegistration.getCancelButton(e).length>0?(TissQuickRegistration.error("You are registered already"),TissQuickRegistration.getButtonStop().click()):(i.autoRefresh.val()&&TissQuickRegistration.refreshPage(),TissQuickRegistration.error("No registration button found"))}static onStudyCodeSelectPage(){let t=TissQuickRegistration.getStudyCodeSelect(),i=TissQuickRegistration.getConfirmButton();TissQuickRegistration.highlight(i),void 0!==TissQuickRegistration.options.studyCode.val()&&TissQuickRegistration.options.studyCode.val().length>0&&TissQuickRegistration.setSelectValue(t,TissQuickRegistration.options.studyCode.val()),i.focus(),TissQuickRegistration.options.autoConfirm.val()&&i.click()}static onConfirmPage(){let t=TissQuickRegistration.getConfirmButton();TissQuickRegistration.highlight(t),t.focus(),TissQuickRegistration.options.autoConfirm.val()&&t.click()}static onConfirmInfoPage(){let t=TissQuickRegistration.getOkButton();TissQuickRegistration.highlight(t),TissQuickRegistration.options.autoOkPressAtEnd.val()&&setTimeout(function(){let t=TissQuickRegistration.getOkButton();t.click()},TissQuickRegistration.options.okPressAtEndDelayInMs.val())}static doLvaCheck(){let t=TissQuickRegistration.getLVANumber(),i=TissQuickRegistration.options.lvaNumber.val();return!(t!==i&&!TissQuickRegistration.isConfirmURL())||(TissQuickRegistration.error("Wrong lva number, expected '"+t+"'"),!1)}static doSemesterCheck(){let t=TissQuickRegistration.getSubHeader(),i=TissQuickRegistration.options.lvaSemester.val();return!(-1===t.indexOf(i)&&!TissQuickRegistration.isConfirmURL())||(TissQuickRegistration.error("Wrong semester, expected '"+i+"'"),!1)}static doGroupCheck(){let t=TissQuickRegistration.getGroupLabel();return!(0===t.length&&!TissQuickRegistration.isConfirmURL())||(TissQuickRegistration.error("Group '"+TissQuickRegistration.options.nameOfGroup.val()+"' not found"),!1)}static doExamCheck(){let t=TissQuickRegistration.getExamLabel(),i=TissQuickRegistration.getExamDate(),e=TissQuickRegistration.getExam(),s=!TissQuickRegistration.isConfirmURL();return 0===t.length&&s?(TissQuickRegistration.error("Exam '"+TissQuickRegistration.options.nameOfExam.val()+"' not found"),!1):0===i.length&&s?(TissQuickRegistration.error("No exam on '"+TissQuickRegistration.getSimpleFormatedDate(TissQuickRegistration.options.dateOfExam.val())+"'"),!1):0!==e.length||!s||(TissQuickRegistration.error("Exam '"+TissQuickRegistration.options.nameOfExam.val()+"' on '"+TissQuickRegistration.getSimpleFormatedDate(TissQuickRegistration.options.dateOfExam.val())+"' not found"),!1)}static isCorrectSemester(){}static injectCoreComponents(){TissQuickRegistration.injectInterface(),TissQuickRegistration.injectCustomCss()}static injectCustomCss(){$("body").prepend("<style>\n:root{--tqr-primary-color:#002d45d2}#tqr-menu{background-color:var(--tqr-primary-color);width:300px;height:500px;position:absolute;border-radius:5px;font-family:Arial,Helvetica,sans-serif;color:#fff;font-size:15px;overflow-y:hidden;transition:height 250ms ease-in-out;z-index:1000;margin-top:20px;margin-left:20px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#tqr-menu.collapsed{height:38px}#tqr-menu.collapsed:has(#tqr-countdown){height:76px}#tqr-menu button{background-color:#f2c998;border:1px solid #c48941;color:#804600;-moz-text-shadow:0 1px 0 #fff;-webkit-text-shadow:0 1px 0 #fff;text-shadow:0 1px 0 #fff}#tqr-menu button:focus{-webkit-box-shadow:0 0 5px 2px #f2c998;box-shadow:0 0 5px 2px #f2c998;outline:0}#tqr-menu input{border:1px solid #c48941!important;color:#804600;-moz-text-shadow:0 1px 0 #fff;-webkit-text-shadow:0 1px 0 #fff;text-shadow:0 1px 0 #fff}#tqr-menu input:focus{border:1px solid #c48941!important;-webkit-box-shadow:0 0 5px 2px #f2c998!important;box-shadow:0 0 5px 2px #f2c998!important;outline:0!important}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:#f2c998;border-radius:10px}::-webkit-scrollbar-thumb:hover{background:#f2c998}.tqr-header{width:100%;height:38px;display:flex;justify-content:center;align-items:center;border-radius:5px 5px 0 0;background-color:var(--tqr-primary-color);display:flex;cursor:pointer;position:relative;top:0;z-index:1002}.tqr-footer{width:100%;height:38px;display:flex;justify-content:center;align-items:center;border-radius:0 0 5px 5px;background-color:var(--tqr-primary-color);display:flex;position:absolute;bottom:0;z-index:1001}.tqr-body{width:calc(100% - 30px);height:calc(100% - 96px);padding:10px 15px;overflow-y:scroll}.collapsed>.tqr-body{display:none}.tqr-headline{font-weight:700;font-size:20px}.tqr-subheadline{font-weight:700;font-size:18px}.tqr-content+.tqr-content{margin-top:20px}.tqr-content>:nth-child(2){margin-top:5px}#tqr-log-window{width:100%;height:100px;display:flex;flex-direction:column;background-color:var(--tqr-primary-color);border-radius:5px;padding:1.25px 4px;overflow-y:scroll}.tqr-log-error{color:#df0000}.tqr-log-success{color:#00c900}#tqr-conf-form>input:not([type=checkbox]){width:100%;text-align:center}.tqr-small-spacer{width:100%;height:5px}.tqr-highlight{background-color:#90ee90!important}\n</style>")}static injectInterface(){$(strings.ids.tiss.header).prepend('\n<div id="tqr-menu" class="collapsed"><div class="tqr-header" onclick="document.getElementById(&#34;tqr-menu&#34;).classList.toggle(&#34;collapsed&#34;)"><span class="tqr-headline">Easy Auto Registration</span></div><div class="tqr-body"><div class="tqr-content"><span class="tqr-subheadline">Log</span><div id="tqr-log-window"></div></div><div class="tqr-content"><span class="tqr-subheadline">Controls</span><div class="tqr-controls"><select name="tqr-select-option" id="tqr-select-option"></select> <button id="tqr-button-save">Save</button> <button id="tqr-button-delete">Delete</button> <button id="tqr-button-start">Start</button> <button id="tqr-button-stop">Stop</button></div></div><div class="tqr-content" id="tqr-conf-form"><span class="tqr-subheadline">Configurations</span></div></div><div class="tqr-footer"></div></div>\n')}static injectOptions(t){if(void 0===t?t=TQROption.loadTQROption(TissQuickRegistration.getLVANumber(),TissQuickRegistration.getRegistrationType()):"string"==typeof t&&(t=t.split("/"),t=TQROption.loadTQROption(t[0],t[1])),null===t){if(t=TQROption.loadTQROptionFromDspwid(TissQuickRegistration.getDspwid()),null===t)throw new Error("Something went wrong loading configuration");console.log(t)}else t.dspwid(TissQuickRegistration.getDspwid());let i=TissQuickRegistration.getConfigurationSection();i.empty(),i.append('<span class="tqr-subheadline">Configurations</span>'),i.append('<div class="tqr-small-spacer"></div>');for(const[e,s]of Object.entries(t.options)){if(tqrOption.excludedOptions.includes(e))continue;let t=e;"boolean"==typeof s?(i.append(TissQuickRegistration.createInput(t,"checkbox",s)),i.append(TissQuickRegistration.createLabel(t,e))):"string"==typeof s?(i.append(TissQuickRegistration.createLabel(t,e)),i.append(TissQuickRegistration.createInput(t,"text",s))):"number"==typeof s?(i.append(TissQuickRegistration.createLabel(t,e)),i.append(TissQuickRegistration.createInput(t,"number",s))):"Date"===s.constructor.name?(i.append(TissQuickRegistration.createLabel(t,e)),i.append(TissQuickRegistration.createInput(t,"datetime-local",s))):i.append(TissQuickRegistration.createLabel(t,e)),i.append('<div class="tqr-small-spacer"></div>')}TissQuickRegistration.options=t,TissQuickRegistration.updateOptionDropdown(t.getKey())}static injectCountdownIntoFooter(){$("#tqr-menu > .tqr-footer").last().html('<span id="tqr-countdown" class="tqr-subheadline">No countdown to display</span>')}static removeCountdownField(){$(strings.ids.tqr.countdown).remove()}static manageControlAccess(){TissQuickRegistration.options.started.val()?(TissQuickRegistration.getOptionSelect().disable(),TissQuickRegistration.getButtonSave().disable(),TissQuickRegistration.getButtonDelete().disable(),TissQuickRegistration.getButtonStart().disable(),TissQuickRegistration.getButtonStop().enable()):(TissQuickRegistration.getOptionSelect().enable(),TissQuickRegistration.getButtonSave().enable(),TissQuickRegistration.getButtonDelete().enable(),TissQuickRegistration.getButtonStart().enable(),TissQuickRegistration.getButtonStop().disable())}static hookControlEvents(){TissQuickRegistration.getButtonSave().on("click",function(){TissQuickRegistration.options.setOptions(TissQuickRegistration.getDataFromConfigurationSection()).save(),TissQuickRegistration.updateOptionDropdown(TissQuickRegistration.options.getKey()),TissQuickRegistration.manageControlAccess(),TissQuickRegistration.log("Saved options to storage")}),TissQuickRegistration.getButtonDelete().on("click",function(){TissQuickRegistration.options.remove(),TissQuickRegistration.updateOptionDropdown(),TissQuickRegistration.manageControlAccess(),TissQuickRegistration.log("Deleted options from storage")}),TissQuickRegistration.getButtonStart().on("click",function(){let t=TissQuickRegistration.getLVANumber()+"/"+TissQuickRegistration.getRegistrationType();TissQuickRegistration.options.getKey()==t||TissQuickRegistration.isConfirmURL()?(TissQuickRegistration.options.started(!0),TissQuickRegistration.getButtonSave().click(),TissQuickRegistration.manageControlAccess(),TissQuickRegistration.getConfigurationInputFields().each(function(){$(this).disable()}),TissQuickRegistration.success("Script started!"),TissQuickRegistration.tissQuickRegistration()):TissQuickRegistration.error("Cannot started with these options!")}),TissQuickRegistration.getButtonStop().on("click",function(){TissQuickRegistration.options.started(!1),TissQuickRegistration.getButtonSave().click(),TissQuickRegistration.manageControlAccess(),TissQuickRegistration.getConfigurationInputFields().each(function(){$(this).enable()}),TissQuickRegistration.getHighlightedElements().each(function(){TissQuickRegistration.removeHighlight(this)}),TissQuickRegistration.error("Script stopped!")}),TissQuickRegistration.getOptionSelect().on("input",function(t){TissQuickRegistration.log("Loading "+t.target.value),TissQuickRegistration.injectOptions(t.target.value),TissQuickRegistration.manageControlAccess()})}static updateOptionDropdown(t){let i=TissQuickRegistration.getOptionSelect();i.empty();let e=!1;for(const s of TQROption.getLocalStorageKeys())s==t&&(e=!0),i.append(TissQuickRegistration.createOption(s,s));e||(i.append(TissQuickRegistration.createOption("","Create new")),t=""),i.val(t).change()}static createLabel(t,i){let e=document.createElement("label");return e.setAttribute("for","tqr-"+t),e.innerHTML=i,e}static createInput(t,i,e){let s=document.createElement("input");return s.setAttribute("type",i),s.setAttribute("id","tqr-"+t),s.setAttribute(strings.attributes.tqr.optionName,t),s.setAttribute("value","datetime-local"==i?TissQuickRegistration.getDateFormat(e):e),s.classList.add(strings.classes.tqr.inputConf.substring(1)),"checkbox"==i&&e&&s.setAttribute("checked","checked"),s}static createOption(t,i){let e=document.createElement("option");return e.setAttribute("value",t),e.innerHTML=i,e}static pageCountdown(t){let i=TissQuickRegistration.getCountdownField();i.text(t)}static highlight(t){$(t).addClass(strings.classes.tqr.highlight.substring(1))}static removeHighlight(t){$(t).removeClass(strings.classes.tqr.highlight.substring(1))}static error(t){TissQuickRegistration.log(t,"error")}static success(t){TissQuickRegistration.log(t,"success")}static log(t,i){let e=TissQuickRegistration.getLogField(),s=document.createElement("span");s.classList.add(strings.classes.tqr.log.substring(1)+(null!=i?"-"+i:"")),s.innerHTML=t,e.append(s),e.scrollTop(e.prop("scrollHeight"))}static refreshPage(){location.reload()}static isConfirmURL(){return autoConfirmUrls.includes(location.href)}static disableAllElements(){$("#tqr-menu button, #tqr-menu input, #tqr-menu select").each(function(){$(this).disable()})}}new TissQuickRegistration;